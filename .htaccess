Options -Indexes

RewriteEngine On

# # https redirect (uncommend block to enable)
# RewriteCond %{HTTPS} !on
# RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
# <IfModule mod_headers.c>
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
# </IfModule>

# # https rediret behind proxy (uncommend block to enable)
# RewriteEngine on
# RewriteCond %{HTTP:X-Forwarded-Proto} !https
# RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# remove trailing slash (external) [if pixolino url]
RewriteCond %{REQUEST_URI} (.+)/$
RewriteCond %{HTTP_HOST}/$1/index.html -f [OR]
RewriteCond %{DOCUMENT_ROOT}/%{HTTP_HOST}/$1/index.html -f
RewriteRule ^(.*)$ %1 [R=302,L,NS]

# virtual host for main html files
RewriteCond %{HTTP_HOST} ^(.+)$
RewriteCond %1/index.html -f [OR]
RewriteCond %{DOCUMENT_ROOT}/%1/index.html -f
RewriteRule ^$ %1/index.html [L,NS]

# virtual host for other html files
RewriteCond %{HTTP_HOST} ^(.+)$
RewriteCond %1/$1/index.html -f [OR]
RewriteCond %{DOCUMENT_ROOT}/%1/$1/index.html -f
RewriteRule ^(.*)$ %1/$1/index.html [L,NS]

# virtual host for other files
RewriteCond %{HTTP_HOST} ^(.+)$
RewriteCond %1/$1 -f [OR]
RewriteCond %{DOCUMENT_ROOT}/%1/$1 -f
RewriteRule ^(.*)$ %1/$1 [L,NS]

# virtual hosts if more rewrites are needed (.htaccess exists)
RewriteCond %{HTTP_HOST} ^(.+)$
RewriteCond %1/.htaccess -f [OR]
RewriteCond %{DOCUMENT_ROOT}/%1/.htaccess -f
RewriteRule ^(.*)$ %1/$1 [NS]
